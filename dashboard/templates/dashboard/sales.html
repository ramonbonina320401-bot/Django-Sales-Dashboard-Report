{% extends 'dashboard/base.html' %}
{% block content %}

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
    <div class="panel bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700/50">
        <div class="label-sm text-gray-400 text-xs font-semibold uppercase tracking-wider mb-1">Total Revenue</div>
        <div class="val-xl text-3xl font-bold text-white mb-2" id="stat-revenue">₱66,668,000</div>
        <div class="sub-caption flex items-center text-teal-400 text-xs font-medium bg-teal-400/10 w-fit px-2 py-1 rounded">
            <i class="fas fa-arrow-up mr-1"></i> 12.5% <span class="text-gray-500 ml-1">vs last month</span>
        </div>
    </div>
    <div class="panel bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700/50">
        <div class="label-sm text-gray-400 text-xs font-semibold uppercase tracking-wider mb-1">Total Capital</div>
        <div class="val-xl text-3xl font-bold text-white mb-2" id="stat-capital">₱40,000,800</div>
        <div class="sub-caption text-gray-500 text-xs">Fixed costs included</div>
    </div>
    <div class="panel bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700/50">
        <div class="label-sm text-gray-400 text-xs font-semibold uppercase tracking-wider mb-1">Gross Profit</div>
        <div class="val-xl text-3xl font-bold text-green-500 mb-2" id="stat-profit">₱26,667,200</div>
        <div class="sub-caption text-green-500 text-xs">Net earnings</div>
    </div>
    <div class="panel bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700/50">
        <div class="label-sm text-gray-400 text-xs font-semibold uppercase tracking-wider mb-1">Profit Margin</div>
        <div class="val-xl text-3xl font-bold text-teal-400 mb-2" id="stat-margin">40.0%</div>
        <div class="sub-caption text-gray-500 text-xs">Performance ratio</div>
    </div>
</div>

<div class="bg-gray-800 p-4 rounded-xl shadow-lg border border-gray-700/50 flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
    <div class="flex items-center gap-3">
        <div class="bg-teal-500/10 p-2 rounded-lg text-teal-400">
            <i class="fas fa-filter"></i>
        </div>
        <div>
            <div class="text-white font-medium text-sm">Dashboard Filters</div>
            <div class="text-gray-500 text-xs">Filter data by active products</div>
        </div>
    </div>
    
    <div class="flex flex-wrap gap-2" id="filter-container">
        <button onclick="updateDashboard('all')" class="filter-btn active px-4 py-1.5 rounded-full text-xs font-medium border transition-all duration-200 bg-teal-500 text-white border-teal-500 shadow-lg shadow-teal-500/20" data-filter="all">All</button>
        
        <button onclick="updateDashboard('laptop')" class="filter-btn px-4 py-1.5 rounded-full text-xs font-medium bg-gray-700 text-gray-300 hover:bg-gray-600 border border-gray-600 transition-all duration-200" data-filter="laptop">Laptop</button>
        <button onclick="updateDashboard('mouse')" class="filter-btn px-4 py-1.5 rounded-full text-xs font-medium bg-gray-700 text-gray-300 hover:bg-gray-600 border border-gray-600 transition-all duration-200" data-filter="mouse">Mouse</button>
        <button onclick="updateDashboard('keyboard')" class="filter-btn px-4 py-1.5 rounded-full text-xs font-medium bg-gray-700 text-gray-300 hover:bg-gray-600 border border-gray-600 transition-all duration-200" data-filter="keyboard">Keyboard</button>
        <button onclick="updateDashboard('monitor')" class="filter-btn px-4 py-1.5 rounded-full text-xs font-medium bg-gray-700 text-gray-300 hover:bg-gray-600 border border-gray-600 transition-all duration-200" data-filter="monitor">Monitor</button>
        <button onclick="updateDashboard('headset')" class="filter-btn px-4 py-1.5 rounded-full text-xs font-medium bg-gray-700 text-gray-300 hover:bg-gray-600 border border-gray-600 transition-all duration-200" data-filter="headset">Headset</button>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700/50">
        <div class="mb-6 flex justify-between items-start">
            <div>
                <div class="flex items-center gap-2 mb-1">
                    <i class="fas fa-chart-line text-blue-400"></i>
                    <h3 class="text-white font-semibold">Sales Trend Report</h3>
                </div>
                <p class="text-gray-500 text-xs">Monthly performance trajectory</p>
            </div>
        </div>
        <div class="relative h-64 w-full">
            <canvas id="salesTrendChart"></canvas>
        </div>
    </div>

    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700/50">
        <div class="mb-6">
            <div class="flex items-center gap-2 mb-1">
                <i class="fas fa-chart-bar text-yellow-400"></i>
                <h3 class="text-white font-semibold">Sales Distribution</h3>
            </div>
            <p class="text-gray-500 text-xs">Transaction volume by value</p>
        </div>
        <div class="relative h-64 w-full">
            <canvas id="salesDistChart"></canvas>
        </div>
    </div>
</div>

<script>
    // --- 1. SETUP CHARTS ---
    const ctxTrend = document.getElementById('salesTrendChart').getContext('2d');
    const ctxDist = document.getElementById('salesDistChart').getContext('2d');
    
    // Gradient for Line Chart
    let gradient = ctxTrend.createLinearGradient(0, 0, 0, 300);
    gradient.addColorStop(0, 'rgba(45, 212, 191, 0.5)'); // Teal with opacity
    gradient.addColorStop(1, 'rgba(45, 212, 191, 0)');

    // Common Chart Options
    const commonOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
            y: { grid: { color: '#374151' }, ticks: { color: '#9ca3af' } },
            x: { grid: { display: false }, ticks: { color: '#9ca3af' } }
        }
    };

    // Initialize Trend Chart
    let trendChart = new Chart(ctxTrend, {
        type: 'line',
        data: {
            labels: ['Dec', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Sales',
                data: [12, 19, 3, 5, 2, 3, 10], // Default Data
                borderColor: '#2dd4bf',
                backgroundColor: gradient,
                borderWidth: 2,
                pointBackgroundColor: '#111827',
                pointBorderColor: '#2dd4bf',
                pointRadius: 4,
                tension: 0.4,
                fill: true
            }]
        },
        options: commonOptions
    });

    // Initialize Distribution Chart
    let distChart = new Chart(ctxDist, {
        type: 'bar',
        data: {
            labels: ['<10k', '10k-50k', '50k-100k', '>100k'],
            datasets: [{
                label: 'Count',
                data: [130, 170, 50, 130], // Default Data
                backgroundColor: '#00C2A2',
                borderRadius: 4,
                barThickness: 40
            }]
        },
        options: commonOptions
    });

    // --- 2. DATASET "DATABASE" (Simulated Backend Data) ---
    // In a real app, you would fetch this from a Django API endpoint
    const mockData = {
        'all': {
            revenue: '₱66,668,000', capital: '₱40,000,800', profit: '₱26,667,200', margin: '40.0%',
            trend: [12, 19, 3, 5, 2, 3, 10],
            dist: [130, 170, 50, 130]
        },
        'laptop': {
            revenue: '₱45,200,000', capital: '₱25,000,000', profit: '₱20,200,000', margin: '44.6%',
            trend: [8, 15, 12, 10, 8, 12, 18], // Laptops sell higher
            dist: [10, 20, 80, 100] // More expensive items
        },
        'mouse': {
            revenue: '₱2,500,000', capital: '₱1,000,000', profit: '₱1,500,000', margin: '60.0%',
            trend: [20, 25, 22, 30, 28, 35, 40], // High volume
            dist: [200, 50, 5, 0] // Cheaper items
        },
        'keyboard': {
            revenue: '₱5,100,000', capital: '₱3,000,000', profit: '₱2,100,000', margin: '41.1%',
            trend: [5, 8, 6, 9, 7, 8, 10],
            dist: [100, 100, 20, 5]
        },
        'monitor': {
            revenue: '₱12,000,000', capital: '₱8,000,000', profit: '₱4,000,000', margin: '33.3%',
            trend: [10, 12, 10, 11, 13, 14, 15],
            dist: [20, 150, 60, 20]
        },
        'headset': {
            revenue: '₱1,868,000', capital: '₱3,000,800', profit: '-₱1,132,800', margin: '-37.0%',
            trend: [5, 4, 3, 2, 1, 2, 3], // Poor performance
            dist: [80, 20, 0, 0]
        }
    };

    // --- 3. FILTER FUNCTION ---
    function updateDashboard(category) {
        const data = mockData[category];

        // A. Update Top Cards (with simple animation)
        document.getElementById('stat-revenue').innerText = data.revenue;
        document.getElementById('stat-capital').innerText = data.capital;
        document.getElementById('stat-profit').innerText = data.profit;
        document.getElementById('stat-margin').innerText = data.margin;

        // B. Update Charts
        trendChart.data.datasets[0].data = data.trend;
        trendChart.update();

        distChart.data.datasets[0].data = data.dist;
        distChart.update();

        // C. Update Button Styles (Visual Feedback)
        // 1. Reset all buttons to gray
        const buttons = document.querySelectorAll('.filter-btn');
        buttons.forEach(btn => {
            btn.className = "filter-btn px-4 py-1.5 rounded-full text-xs font-medium bg-gray-700 text-gray-300 hover:bg-gray-600 border border-gray-600 transition-all duration-200 cursor-pointer";
        });

        // 2. Highlight clicked button (Teal)
        const activeBtn = document.querySelector(`button[data-filter="${category}"]`);
        activeBtn.className = "filter-btn px-4 py-1.5 rounded-full text-xs font-medium bg-teal-500 text-white border border-teal-500 shadow-lg shadow-teal-500/20 transition-all duration-200 cursor-pointer transform scale-105";
    }
</script>
{% endblock %}